
SYSPROP="$MODPATH"/system.prop; PERPROP="$MODPATH"/persist.prop; POSTFS="$MODPATH"/post-fs-data.sh; SERV="$MODPATH"/service.sh; su -c "pm clear com.oplus.camera"; { ! $KSU && [ "$(echo "$MAGISK_VER" | awk -F- '{print $NF}')" != "delta" ] && [ "$(echo "$MAGISK_VER" | awk -F- '{print $NF}')" != "kitsune" ]; } && { [ "$API" -le 29 ] && sed -i -e "1i\\mf() {\n  local sd=\\\"\$1\\\"; local td=\\\"\$2\\\"\n  [ ! -d \\\"\$sd\\\" ] && return\n  find \\\"\$sd\\\" -type f | while read -r f; do\n    rp=\\\"\${f#\$sd}\\\"; tf=\\\"\$td\$rp\\\"; mount -o bind \\\"\$f\\\" \\\"\$tf\\\"\n  done\n}\nfor part in $PARTITIONS; do\n  pn=\\\"\${part#/}\\\"; sd=\\\"\$MODDIR/\$pn\\\"; td=\\\"/\$pn\\\"; mf \\\"\$sd\\\" \\\"\$td\\\"\ndone" "$POSTFS" || sed -i -e "1i\\mfo() {\n  local s=\\\"\$1\\\"; local d=\\\"\$2\\\"; local wb=\\\"/dev/${MODNAME}_ovrl\\\"\n  local up=\\\"\$wb/upper\${d}\\\"; local wo=\\\"\$wb/work\${d}\\\"\n  [ ! -d \\\"\$s\\\" ] && return; [ -d \\\"\$d\\\" ] || return\n  mkdir -p \\\"\$up\\\" \\\"\$wo\\\"; cp -a \\\"\$s/.\\\" \\\"\$up/\\\"\n  mount -t overlay overlay -o lowerdir=\\\"\$d\\\",upperdir=\\\"\$up\\\",workdir=\\\"\$wo\\\" \\\"\$d\\\"\n}\nfor part in ${PARTITIONS}; do\n  pn=\\\"\${part#/}\\\"; s=\\\"\$MODPATH/\\\$pn\\\"; d=\\\"/\\\$pn\\\"; mfo \\\"\$s\\\" \\\"\$d\\\"\ndone" "$POSTFS"; }
